<div class="daily-agenda-container">
  <!-- Cabeçalho com horários -->
  <div class="time-header">
    <div class="groups-header" *ngIf="config.showGroups && groups.length > 0">Grupos</div>
    <div class="time-slots">
      <div class="time-slot" *ngFor="let timeSlot of timeSlots">
        {{ timeSlot }}
      </div>
    </div>
  </div>

  <!-- Conteúdo da agenda -->
  <div class="agenda-content">
    <!-- Grupos (se habilitados) -->
    <div class="groups-container" *ngIf="config.showGroups && groups.length > 0">
      <ng-container *ngFor="let group of groups">
        <!-- Grupo principal -->
        <div class="group-item" [style.background-color]="group.color || '#f0f0f0'">
          {{ group.name }}
        </div>
        
        <!-- Subgrupos (se existirem) -->
        <ng-container *ngIf="config.showSubgroups && group.subgroups && group.subgroups.length > 0">
          <ng-container *ngFor="let subgroup of group.subgroups">
            <div class="subgroup-item" 
                [style.background-color]="subgroup.color || group.color || '#f0f0f0'">
              {{ subgroup.name }}
            </div>
            
            <!-- Sub-subgrupos (se existirem) -->
            <ng-container *ngIf="config.showSubSubgroups && subgroup.subSubgroups && subgroup.subSubgroups.length > 0">
              <ng-container *ngFor="let subSubgroup of subgroup.subSubgroups">
                <div class="sub-subgroup-item" 
                    [style.background-color]="subSubgroup.color || subgroup.color || group.color || '#f0f0f0'">
                  {{ subSubgroup.name }}
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>

    <!-- Grade da agenda -->
    <div class="agenda-grid" #agendaGrid (scroll)="onGridScroll($event)">
      <!-- Linhas para cada grupo, subgrupo ou sub-subgrupo -->
      <div class="agenda-rows-container">
        <div class="agenda-row" *ngFor="let groupEntry of groupedItems | keyvalue" 
             [ngClass]="{'group-row': !groupEntry.key.includes('_'), 
                        'subgroup-row': groupEntry.key.includes('_') && !groupEntry.key.split('_')[2],
                        'sub-subgroup-row': groupEntry.key.includes('_') && groupEntry.key.split('_')[2]}">
          <div class="agenda-row-content">
            <!-- Linhas de tempo -->
            <div class="time-grid-lines">
              <div class="time-line" *ngFor="let timeSlot of timeSlots"></div>
            </div>
            
            <!-- Itens da agenda -->
            <div class="agenda-item" 
                *ngFor="let item of groupEntry.value" 
                [style.top]="getItemPosition(item).top"
                [style.left]="getItemPosition(item).left"
                [style.width]="getItemPosition(item).width"
                [style.height]="getItemPosition(item).height"
                [style.background-color]="item.color || (getGroupById(item.groupId || 'default')?.color || '#4285f4')"
                [class.agenda-item-selected]="selectedItem === item"
                (click)="selectItem(item)">
              <div class="agenda-item-content">
                <div class="agenda-item-title">{{ item.title }}</div>
                <div class="agenda-item-time">
                  {{ item.startTime | date:'HH:mm' }} - {{ item.endTime | date:'HH:mm' }}
                </div>
                <div class="agenda-item-description" *ngIf="item.description">
                  {{ item.description }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>